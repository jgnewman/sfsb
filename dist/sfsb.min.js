!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};if(canPost){var queue=[];return window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}}return function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(require){(function(process){function stringify(data){var output="";return"string"==typeof data?data:(Object.keys(data).forEach(function(key){var value=data[key];"object"==typeof value?Array.isArray(value)?value.forEach(function(arrItem){output+="&"+key+"[]="+encodeURIComponent(arrItem)}):Object.keys(value).forEach(function(subKey){output+="&"+key+"{"+subKey+"}="+encodeURIComponent(value[subKey])}):output+="&"+key+"="+encodeURIComponent(value)}),output.slice(1))}function createXHR(settings,prevRequest){var req,nextTimeout,url,data,removeListeners,method=settings.type?settings.type.toUpperCase():"GET";removeListeners=function(req){req&&(req.removeEventListener("load"),req.removeEventListener("error"))},wasUpdated&&removeListeners(prevRequest),req=!prevRequest||wasUpdated?new XMLHttpRequest:prevRequest,Object.prototype.hasOwnProperty.call(settings,"data")&&(data=stringify(settings.data)),"GET"===method&&(data="?"+data),url=settings.url+("GET"===method?data||"":""),req.open(method,url,!0),(!prevRequest||wasUpdated)&&req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),(!prevRequest||wasUpdated)&&Object.prototype.hasOwnProperty(settings,"headers")&&Object.keys(settings.headers).forEach(function(key){req.setRequestHeader(key,settings.headers[key])}),req.duration=+new Date,req.send("POST"===method||"DELETE"===method||"PUT"===method?data||null:null),req.customTimer=setTimeout(function(){req.abort(),removeListeners(req),self.postMessage(resData={success:!1,response:"timeout",status:req.status,prevFreq:prevFreq||0,duration:+new Date-req.duration,sent:settings.data,utf8Bytes:0}),req.always(resData,!0)},1e4),(!prevRequest||wasUpdated)&&req.addEventListener("load",function(evt){var status=parseInt(evt.srcElement.status),size=byteSize(evt.srcElement.responseText);clearTimeout(req.customTimer),self.postMessage(200>status||status>299||!size?resData={success:!1,response:evt.srcElement.responseText,status:evt.srcElement.status,prevFreq:prevFreq||0,duration:+new Date-req.duration,sent:settings.data,utf8Bytes:size}:resData={success:!0,response:process?process(evt.srcElement.responseText):evt.srcElement.responseText,status:evt.srcElement.status,prevFreq:prevFreq||0,duration:+new Date-req.duration,sent:settings.data,utf8Bytes:size}),req.always(resData)}),(!prevRequest||wasUpdated)&&req.addEventListener("error",function(evt){clearTimeout(req.customTimer),self.postMessage(resData={success:!1,response:evt.srcElement.responseText,status:evt.srcElement.status,prevFreq:prevFreq||0,duration:+new Date-req.duration,sent:settings.data,utf8Bytes:byteSize(evt.srcElement.responseText)}),req.always(resData)}),(!prevRequest||wasUpdated)&&(req.always=function(responseData,timeout){var nextReq,delay,subscriber;"GET"===method?(haveRefresh&&(reqCount+=1),responseData&&backoff&&(nextTimeout=prevFreq=responseData.success?frequency:backoff(responseData)),nextReq=function(){unsubscribe(subscriber),haveRefresh&&reqCount>=refresh?self.postMessage({refresh:!0,params:settings.data}):createXHR(globals)},delay=setTimeout(nextReq,nextTimeout||frequency),subscriber=function(){clearTimeout(delay),unsubscribe(subscriber),nextReq()},subscribe(subscriber)):!timeout&&removeListeners(req)})}function SFSB(url,cb){var worker=secretary(),specificTask=wstask.replace("{{SOCKETURL}}",'"'+url+'"').replace("{{CALLBACK}}",cb?cb.toString():"null");worker.postJob(specificTask,!0),this.worker=worker}function completePollTask(settings){return pltask.replace("{{GLOBALS}}",JSON.stringify(settings)).replace("{{PROCESS}}",settings.process?settings.process.toString():"null").replace("{{BACKOFF}}",settings.backoff?settings.backoff.toString():"null").replace("{{FREQNCY}}",settings.frequency||3e4).replace("{{REFRESH}}",settings.refresh?settings.refresh:null).replace("{{HAVEREF}}",String("number"==typeof settings.refresh))}function SFAP(settings){var worker,specificTask,messageListener,errorListener;settings.type="GET",worker=secretary(),specificTask=completePollTask(settings),worker.postJob(specificTask,!0),messageListener=function(msg){var method;msg.data.refresh===!0?this.refresh(msg.data.params):(method=msg.data.success?"success":"error",this["on"+method].forEach(function(callback){callback(msg.data)}),this.onmessage.forEach(function(callback){callback(msg.data)}))}.bind(this),errorListener=function(msg){var toPass={success:!1,response:msg,status:-1};this.onerror.forEach(function(callback){callback(toPass)}),this.onmessage.forEach(function(callback){callback(toPass)})}.bind(this),this.refresh=function(currentParams){settings.data=currentParams,this.task=completePollTask(settings),this.worker.end(),this.worker=secretary(),this.worker.postJob(this.task,!0),this.worker.addListener("message",messageListener),this.worker.addListener("error",errorListener)},worker.addListener("message",messageListener),worker.addListener("error",errorListener),this.worker=worker,this.task=specificTask,this.settings=settings,this.onsuccess=[],this.onerror=[],this.onmessage=[]}var wstask,pltask,global=window,secretary=require("./secretary");pltask="function () {  var globals     = {{GLOBALS}},      process     = {{PROCESS}},      backoff     = {{BACKOFF}},      frequency   = {{FREQNCY}},      refresh     = {{REFRESH}},      haveRefresh = {{HAVEREF}},      reqCount    = 0,      subs        = [],      wasUpdated  = false,      prevFreq;  function byteSize(s) {    return encodeURI(s).split(/%..|./).length - 1;  } function subscribe(fn) { subs.push(fn) } function unsubscribe(fn) { subs.splice(subs.indexOf(fn), 1) } function update() { subs.forEach(function (each) { each() }) }"+stringify.toString()+createXHR.toString()+'  createXHR(globals);  return function (msg) {    if (msg.type === "UPDATE") {      globals.data = msg.params;      update();      wasUpdated = true;      return;    }    msg.url = globals.url;    !msg.timeout && (msg.timeout = globals.timeout);    !msg.headers && (msg.headers = globals.headers);    createXHR(msg);  };}',wstask="function () {  var socket   = new WebSocket({{SOCKETURL}}),      origSend = WebSocket.prototype.send,      callback = {{CALLBACK}};  WebSocket.prototype.send = function (msg) {    if (this.readyState !== 1) {      return setTimeout(function () {this.send(msg)}.bind(this), 10);    }    return origSend.call(this, msg);  };  socket.onmessage = function (msg) {    self.postMessage(callback ? callback(msg.data) : msg.data);  };  return function (msg) {    socket.send(msg);  };}",SFSB.prototype={send:function(msg){return this.worker.postMessage(msg),this},close:function(){return this.worker.end(),this},addEventListener:function(evt,fn){return this.worker.addListener(evt,fn),this}},SFAP.prototype={close:function(){return this.worker.end(),this},post:function(settings){return settings.type="POST",this.worker.postMessage(settings),this},put:function(settings){return settings.type="PUT",this.worker.postMessage(settings),this},del:function(settings){return settings.type="DELETE",this.worker.postMessage(settings),this},update:function(paramObj){return this.worker.postMessage({type:"UPDATE",params:paramObj}),this},addEventListener:function(evt,callback){return this["on"+evt.toLowerCase()].push(callback),this}},global.SF={socketBooster:SFSB,ajaxPoller:SFAP}}).call(this,require("/Users/john/Sites/github/sfsb/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./secretary":3,"/Users/john/Sites/github/sfsb/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":1}],3:[function(require,module){function workerBody(){var lambda,evalInContext,that=this;evalInContext=function(ctx,src){var newSrc=new Function("return "+src+";");return newSrc.call(ctx)},this.onmessage=function(evt){var job;switch(evt.data.label){case"job":return job=new Function(evt.data.msg.params[0],evt.data.msg.body),lambda=evt.data.msg.immediate?job():job;case"cmd":return evalInContext(that,evt.data.msg.body);case"message":return lambda(evt.data.msg);case"close":return self.close()}}}function fnComponents(fn,isImmediate){var str;return fn="function"==typeof fn?fn.toString():fn,str=fn.replace(/^function\s*[^\(]*\s*\(/,""),{body:str.replace(/^[^\)]*\)\s*\{|\}$/g,""),immediate:!!isImmediate,params:str.replace(/\s+/g,"").replace(/\).*$/,"").split(",")}}function createWorker(){var worker=new Worker(window.URL.createObjectURL(workerBlob)),messageHook=[],errorHook=[],closeHook=[];return worker.onmessage=function(evt){messageHook.forEach(function(fn){fn(evt)})},worker.onerror=function(evt){errorHook.forEach(function(fn){fn(evt)})},worker.onclose=function(evt){closeHook.forEach(function(fn){fn(evt)})},{addListener:function(evtName,fn){switch(evtName){case"message":messageHook.push(fn);break;case"error":errorHook.push(fn)}return this},postJob:function(fn,isImmediate){return worker.postMessage({label:"job",msg:fnComponents(fn,isImmediate)}),this},postCmd:function(fn){return worker.postMessage({label:"cmd",msg:fnComponents(fn)}),this},postMessage:function(message){return worker.postMessage({label:"message",msg:message}),this},end:function(time){var closed=!1;this.addListener("close",function(){closed=!0}),setTimeout(function(){!closed&&worker.terminate()},100),this.postCmd(function(){self.close()})}}}var workerBlob;workerBlob=new Blob([fnComponents(workerBody).body],{type:"text/javascript"}),module.exports=createWorker},{}]},{},[2]);